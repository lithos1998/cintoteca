<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Inventario</title>
</head>
<body>
    <div id="modalOkId" class="message-modal modal-ok d-none">
        <h1 id="modal_ok_title"></h1>
        <h1 style="margin-top: 20px !important;">✔</h1>
    </div>

    <div id="modalErrorId" class="message-modal modal-error d-none">
        <h1 id="modal_error_title">Ocurrion un error</h1>
        <h1 style="margin-top: 0px !important;">⊗</h1>
        <p></p>
    </div>

    <div id="modal-add" class="modal d-none">
        <div class="card">
            <div class="cuadro-agregar">
                <form id="add">
                    <div>
                        <label>Estanteria</label>
                        <select id="estanteria" name="estanteria">
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                            <option>6</option>
                            <option>7</option>
                            <option>8</option>
                            <option>9</option>
                            <option>10</option>
                        </select>
                    </div>

                    <div>
                        <label>Estante</label>
                        <select id="estante" name="estante">
                            <option>a</option>
                            <option>b</option>
                            <option>c</option>
                            <option>d</option>
                            <option>e</option>
                            <option>f</option>
                            <option>g</option>
                        </select>
                    </div>

                    <div>
                        <label>tipo</label>
                        <select id="tipo-cinta" name="tipo-cinta">
                            <option>Lt</option>
                            <option>B0</option>
                        </select>
                    </div>

                    <div>
                        <label>De:</label>
                        <input id="codigo-de" name="codigo-de" type="text" placeholder="4400">
                    </div>
                        
                    <div>
                        <label>Hasta:</label>
                        <input id="codigo-hasta" name="codigo-hasta" type="text" placeholder="4449">
                    </div>

                    <div>
                        <label>Generacion</label>
                        <select id="generacion" name="generacion">
                            <option>L5</option>
                            <option>L6</option>
                            <option>L7</option>
                        </select>
                    </div>
                    
                    <input class="button" type="submit" value="Agregar">

                    <input id="cancel-add" class="button cancel" type="button" value="Cancelar">
                </form>
            </div>
        </div>
    </div>

    <div id="modal-show" class="modal d-none">
        <div class="card">
            <h1 id="cinta"></h1>
            <h2>Estanteria nº <span id="estanteria-loc"></span></h2>

            <div class="estantes">
                <div id="a"></div>
                <div id="b"></div>
                <div id="c"></div>
                <div id="d"></div>
                <div id="e"></div>
                <div id="f"></div>
                <div id="g"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="cuadro-busqueda">
            <form id="search">
                <select id="sufijo" class="input-1">
                    <option>Lt</option>
                    <option>B0</option>
                </select>
                
                <input id="codigo" class="input-2" type="number" placeholder="4400">

                <select id="generacion" class="input-3">
                    <option>L6</option>
                    <option>L5</option>
                    <option>L7</option>
                </select>

                <input class="button" type="submit" value="Buscar">
            </form>
        </div>

        <div class="agregar"  id="add-cintas">
            <a>Agregar cintas</a>
        </div>
    </div>

    <script>
        modal = document.getElementById("modal-add");
        modal_error = document.getElementById("modalErrorId");
        modal_ok = document.getElementById("modalOkId");
        modal_show = document.getElementById("modal-show");

        function viewModal(modal, option) {
            if (option == "show") {
                modal.classList.remove("d-none");
            } else {
                modal.classList.add("d-none");
            }            
        }

        document.getElementById("modalErrorId").addEventListener("click", function(){
            viewModal(modal_error, "hide");
        });

        document.getElementById("modalOkId").addEventListener("click", function(){
            viewModal(modal_ok, "hide");
        });

        document.getElementById("add-cintas").addEventListener("click", function () {
            viewModal(modal, "show");
        });

        document.getElementById("cancel-add").addEventListener("click", function () {
            viewModal(modal, "hide");
        });

        document.getElementById("search").addEventListener("submit", function (event) {
            event.preventDefault();

            let formData = {
                sufijo: document.getElementById("sufijo").value,
                codigo: document.getElementById("codigo").value,
                generacion: document.getElementById("generacion").value,
            }

            fetch('http://localhost:8000/api/viewLocation',{
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json"
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                status = response.status; 
                
                if(status == 404){
                    viewModal(modal_error, "show");
                    document.getElementById("modal_error_title").innerText = "No se encontro la cinta";
                }
                return response.json()
            })
            .then(data => {
                console.log(data);

                if (data['content']['codigo'] != undefined) {
                    let clase = data['content']['estante'];
                    document.getElementById("cinta").innerText = data['content']['codigo'];
                    document.getElementById("estanteria-loc").innerText = data['content']['estanteria'];
                    document.getElementById(clase).classList.add('selected');
                    document.getElementById(clase).innerHTML = "<p>"+clase+"</p>";
                    viewModal(modal_show, "show");
                }
                
            })
            .catch(error => console.error("Error al obtener los datos:", error));
        });

        document.getElementById("add").addEventListener("submit", function (event) { 
            event.preventDefault();
            let formData = {
                estanteria: document.getElementById("estanteria").value,
                estante: document.getElementById("estante").value,
                tipo: document.getElementById("tipo-cinta").value,
                codigo_de: document.getElementById("codigo-de").value,
                codigo_hasta: document.getElementById("codigo-hasta").value,
                generacion: document.getElementById("generacion").value,
            }

            fetch("http://localhost:8000/api/addcintas", { 
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json"
            },
            body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("modalOkId").classList.remove("d-none");
            })
            .catch(error => {
                console.error("Error:", error);
            });
            
            viewModal(modal, "hide"); 
        });
    </script>
</body>
</html>